<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>تسجيل الدخول | كلية تقنية المعلومات</title>

  <style>
    * {
      box-sizing: border-box;
      font-family: "Segoe UI", Tahoma, sans-serif;
    }

    body {
      margin: 0;
      height: 100vh;
      background: linear-gradient(135deg, #0d3b66, #1e6091);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .login-container {
      background: white;
      width: 900px;
      height: 500px;
      display: flex;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 20px 40px rgba(0,0,0,0.25);
    }

    .login-left {
      flex: 1;
      background: #0d3b66;
      color: white;
      padding: 40px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    .login-left img {
      width: 120px;
      margin-bottom: 20px;
    }

    .login-left h2 {
      margin: 0;
    }

    .login-left p {
      opacity: 0.9;
      margin-top: 10px;
      font-size: 14px;
    }

    .login-right {
      flex: 1;
      padding: 50px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .login-right h3 {
      margin-bottom: 20px;
      color: #0d3b66;
    }

    .login-right input {
      padding: 12px;
      margin-bottom: 15px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
    }

    .login-right button {
      padding: 12px;
      background: #0d3b66;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 15px;
    }

    .login-right button:hover {
      background: #092b4c;
    }

    .error {
      margin-top: 10px;
      color: red;
      font-size: 14px;
    }

    .main-footer {
      margin-top: 25px;
      font-size: 13px;
      color: #e0e0e0;
      text-align: center;
    }

    @media (max-width: 900px) {
      .login-container {
        flex-direction: column;
        width: 90%;
        height: auto;
      }
    }
  </style>
</head>

<body>

<div class="login-container">

  <div class="login-left">
    <img src="assets/logo.png">
    <h2>كلية تقنية المعلومات</h2>
    <p>جامعة النصر التقنية<br>نظام إدارة المحاضرات والمواد</p>
  </div>

  <div class="login-right">
    <h3>تسجيل الدخول</h3>

    <input type="email" id="email" placeholder="البريد الإلكتروني">
    <input type="password" id="password" placeholder="كلمة المرور">
    <button onclick="login()">دخول</button>

    <div class="error" id="error"></div>
  </div>

</div>

<footer class="main-footer">
  إنشاء: <strong>ضياء الدين إبراهيم</strong> —
  حقوق النشر © <span id="year"></span> جامعة النصر التقنية
</footer>

<script>
 document.getElementById("year").innerText = new Date().getFullYear();

  async function login() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    const res = await fetch("http://localhost:5000/api/auth/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password })
    });

    const data = await res.json();

    if (!res.ok) {
      document.getElementById("error").innerText = data;
      return;
    }

    localStorage.setItem("token", data.token);
    localStorage.setItem("user", JSON.stringify(data.user));

    const user = data.user;

    // التحقق من الدور وتوجيه العميد إلى صفحة الـ Admin
    if (user.roles.includes("dean")) {
      window.location.href = "admin_dashboard.html";  // توجيه العميد إلى لوحة تحكم الإدارة
    } else {
      window.location.href = "dashboard.html";  // توجيه الطلاب والدكاترة إلى لوحة التحكم الخاصة بهم
    }
  }
</script>

</body>
</html>
